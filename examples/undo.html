<!doctype html>
<html data-reactid=".19r0v3l5iww" data-react-checksum="971735734"><head data-reactid=".19r0v3l5iww.0"><title data-reactid=".19r0v3l5iww.0.0">React Forms</title><link rel="stylesheet" href="&#x2f;react-forms&#x2f;styles&#x2f;index.css" data-reactid=".19r0v3l5iww.0.1"></head><body title="React Forms" data-reactid=".19r0v3l5iww.1"><nav class="NavigationBar navbar navbar-default navbar-fixed-top" role="navigation" data-reactid=".19r0v3l5iww.1.0"><div class="container-fluid" data-reactid=".19r0v3l5iww.1.0.0"><div class="navbar-header" data-reactid=".19r0v3l5iww.1.0.0.0"><a class="navbar-brand" href="&#x2f;react-forms&#x2f;" data-reactid=".19r0v3l5iww.1.0.0.0.0">React Forms</a></div><div class="collapse navbar-collapse" data-reactid=".19r0v3l5iww.1.0.0.1"><ul class="nav navbar-nav" data-reactid=".19r0v3l5iww.1.0.0.1.0"><li class="dropdown" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;"><a class="dropdown-toggle" href="&#x2f;react-forms&#x2f;documentation&#x2f;" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.0"><span data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.0.0">Documentation</span><span data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.0.1"> </span><b class="caret" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.0.2"></b></a><ul class="dropdown-menu" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1"><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;"><a href="&#x2f;react-forms&#x2f;documentation&#x2f;" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;.0">Overview</a></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;schema=1html"><a href="&#x2f;react-forms&#x2f;documentation&#x2f;schema.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;schema=1html.0">Schemas and validation</a></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;customizations=1html"><a href="&#x2f;react-forms&#x2f;documentation&#x2f;customizations.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$documentation&#x2f;.1.$documentation&#x2f;__documentation&#x2f;customizations=1html.0">Customizations</a></li></ul></li><li class="dropdown" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html"><a class="dropdown-toggle" href="&#x2f;react-forms&#x2f;examples&#x2f;family-editor.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.0"><span data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.0.0">Examples</span><span data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.0.1"> </span><b class="caret" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.0.2"></b></a><ul class="dropdown-menu" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1"><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;family-editor=1html"><a href="&#x2f;react-forms&#x2f;examples&#x2f;family-editor.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;family-editor=1html.0">Family editor form</a></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;array-editor=1html"><a href="&#x2f;react-forms&#x2f;examples&#x2f;array-editor.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;array-editor=1html.0">Array editor form</a></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;sortable-list=1html"><a href="&#x2f;react-forms&#x2f;examples&#x2f;sortable-list.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;sortable-list=1html.0">Sortable list</a></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;undo=1html"><a href="&#x2f;react-forms&#x2f;examples&#x2f;undo.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$examples&#x2f;family-editor=1html.1.$examples&#x2f;family-editor=1html__examples&#x2f;undo=1html.0">Form with undo stack</a></li></ul></li><li data-reactid=".19r0v3l5iww.1.0.0.1.0.$api=1html"><a href="&#x2f;react-forms&#x2f;api.html" data-reactid=".19r0v3l5iww.1.0.0.1.0.$api=1html.0">API</a></li></ul><div class="navbar-repo" data-reactid=".19r0v3l5iww.1.0.0.1.1"><a href="https:&#x2f;&#x2f;github.com&#x2f;prometheusresearch&#x2f;react-forms" data-reactid=".19r0v3l5iww.1.0.0.1.1.0"><span data-reactid=".19r0v3l5iww.1.0.0.1.1.0.0">React Forms</span><span data-reactid=".19r0v3l5iww.1.0.0.1.1.0.1"> on GitHub →</span></a></div></div></div></nav><div class="wrapper" data-reactid=".19r0v3l5iww.1.1"><div class="ExampleDownload container" data-reactid=".19r0v3l5iww.1.1.0"><a href="https:&#x2f;&#x2f;github.com&#x2f;prometheusresearch&#x2f;react-forms&#x2f;blob&#x2f;master&#x2f;docs&#x2f;contents&#x2f;scripts&#x2f;examples&#x2f;undo.jsx" data-reactid=".19r0v3l5iww.1.1.0.0">See example code</a></div><div class="Content container" data-reactid=".19r0v3l5iww.1.1.1"><h1 id="form-with-undo-redo-stack">Form with undo/redo stack</h1>
<p>This examples demonstrates how to implement undo/redo functionality with React
Forms. Because React Forms keeps its state (value and validation info) immutable
it is possible to make a state snapshot at any time with almost no overhead.</p>
<p>This particular examples only make a snapshot before destructive operations such
as adding/removing a fieldset in repeating fieldset.</p>
<div id="example"></div>

<h2 id="implementation">Implementation</h2>
<p>Due to the <a href="/react-forms/documentation/#dataflow">dataflow</a> provided by React Forms the implementation is quite
compact.</p>
<h4 id="undostack">UndoStack</h4>
<p>First we define a reusable <code>UndoStack</code> mixin:</p>
<pre><code>var UndoStack = {

  getInitialState: function() {
    return {undo: [], redo: []}
  },

  snapshot: function() {
    var undo = this.state.undo.concat(this.getStateSnapshot())
    this.setState({undo, redo: []})
  },

  hasUndo: function() {
    return this.state.undo.length &gt; 0
  },

  hasRedo: function() {
    return this.state.redo.length &gt; 0
  },

  redo: function() {
    this._undoImpl(true)
  },

  undo: function() {
    this._undoImpl()
  },

  _undoImpl: function(isRedo) {
    var undo = this.state.undo.slice(0)
    var redo = this.state.redo.slice(0)
    var snapshot

    if (isRedo) {
      if (redo.length === 0) {
        return
      }
      snapshot = redo.pop()
      undo.push(this.getStateSnapshot())
    } else {
      if (undo.length === 0) {
        return
      }
      snapshot = undo.pop()
      redo.push(this.getStateSnapshot())
    }

    this.setStateSnapshot(snapshot)
    this.setState({undo, redo})
  }
}
</code></pre><p>This mixin is completely reusable outside of React Forms, it expects a component
which uses it to define <code>getStateSnapshot()</code> and <code>setStateSnapshot(snapshot)</code>
methods which returns and installs state snapshots.</p>
<h4 id="undocontrols">UndoControls</h4>
<p>Next we define a simple undo controls component which renders two buttons for
&quot;undo&quot; and &quot;redo&quot; actions and fire corresponding callbacks:</p>
<pre><code>var UndoControls = React.createClass({
  render: function() {
    return (
      &lt;div className=&quot;UndoControls&quot;&gt;
        &lt;button
          disabled={!this.props.hasUndo}
          onClick={this.props.onUndo}
          type=&quot;button&quot; className=&quot;btn btn-info btn-xs&quot;&gt;
          ⟲ Undo
        &lt;/button&gt;
        &lt;button
          disabled={!this.props.hasRedo}
          onClick={this.props.onRedo}
          type=&quot;button&quot; className=&quot;btn btn-info btn-xs&quot;&gt;
          ⟳ Redo
        &lt;/button&gt;
      &lt;/div&gt;
    )
  }
})
</code></pre><h4 id="formwithundo">FormWithUndo</h4>
<p>The final part is to define a custom <code>Form</code> component which renders
<code>UndoControls</code> and mixes in <code>UndoStack</code> mixin:</p>
<pre><code>var FormWithUndo = React.createClass({
  mixins: [ReactForms.FormMixin, UndoStack],

  getStateSnapshot: function() {
    return {value: this.valueLens().val()}
  },

  setStateSnapshot: function(snapshot) {
    this.onValueUpdate(snapshot.value)
  },

  render: function() {
    return this.transferPropsTo(
      &lt;form className=&quot;Form&quot;&gt;
        &lt;UndoControls
          hasUndo={this.hasUndo()}
          hasRedo={this.hasRedo()}
          onUndo={this.undo}
          onRedo={this.redo}
          /&gt;
        &lt;RepeatingFieldset
          onRemove={this.snapshot}
          onAdd={this.snapshot} /&gt;
      &lt;/form&gt;
    )
  }
})
</code></pre><p>The <code>FormWithUndo</code> usage is no different than using an original <code>Form</code>
component:</p>
<pre><code>var Products = (
  &lt;List label=&quot;Products&quot;&gt;
    &lt;Schema&gt;
      &lt;Property name=&quot;name&quot; label=&quot;Name&quot; /&gt;
      &lt;Property type=&quot;number&quot; name=&quot;price&quot; label=&quot;Price&quot; /&gt;
    &lt;/Schema&gt;
  &lt;/List&gt;
)

React.renderComponent(
  &lt;FormWithUndo schema={Products} value={[{name: &#39;TV&#39;, price: 1000}]} /&gt;
  document.getElementById(&#39;example&#39;)
)
</code></pre></div></div><script src="&#x2f;react-forms&#x2f;scripts&#x2f;react.js" data-reactid=".19r0v3l5iww.1.2"></script><script src="&#x2f;react-forms&#x2f;scripts&#x2f;react-forms.js" data-reactid=".19r0v3l5iww.1.3"></script><script src="&#x2f;react-forms&#x2f;scripts&#x2f;ShowValue.js" data-reactid=".19r0v3l5iww.1.4:$0"></script><script src="&#x2f;react-forms&#x2f;scripts&#x2f;examples&#x2f;undo.js" data-reactid=".19r0v3l5iww.1.4:$1"></script></body></html>